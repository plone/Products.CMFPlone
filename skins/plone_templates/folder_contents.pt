<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      i18n:domain="plone"
      metal:use-macro="here/main_template/macros/master">

  <head>
      <metal:block fill-slot="top_slot">
        <span tal:replace="nothing"
              tal:define="dummy python:request.set('enable_border', 1)" />
      </metal:block>
  </head>

  <body>

    <div metal:fill-slot="main"
         tal:define="standalone python:1;
                     myfolder python: here_url==mtool.getHomeUrl();
                     contentTypes python: here.getAllowedTypes();
                     num_types python: len(contentTypes)">

      <form name="folderContentsForm"
            method="post"
            action="folder_object"
            tal:attributes="action here_url"
            tal:define="batch python:here.batchedFolderContents(suppressHiddenFiles=1);">


        <h1>
          <tal:block replace="structure python:getattr(here, here.getIcon(1))"/>
          <span tal:content="here/title_or_id" tal:omit-tag="">Directory Id</span>
        </h1>

        <div metal:use-macro="here/document_actions/macros/document_actions">
          Document actions (print, sendto etc)
        </div>

        <a href=""
           class="link-parent"
           tal:define="parent_url python:here.navigationParent(here, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">
          Up one level
        </a>

        <p tal:content="structure here/Description">
          Description
        </p>

        <p tal:condition="not: batch"
           i18n:translate="description_no_visible_items_add_paste">
          This folder has no visible items. To add content, press the
          add button, or paste content from another location.
        </p>

        <!-- Navigation -->
        <div metal:use-macro="here/batch_macros/macros/navigation" />
        <metal:block define-macro="folder_listing"
                     tal:define="locked portal/lock_icon.gif;
                                 pencil_icon portal/edit.gif;
                                 use_folder_contents site_properties/typesLinkToFolderContentsInFC | python:['Folder','Large Plone Folder'];
                                 isExpired nocall:portal/isExpired;
                                 toPortalTime nocall:portal/toPortalTime;
                                 getObjSize nocall:portal/getObjSize;
                                 lock_tool portal/portal_lock|nothing;
                                 getInfoFor python:wtool.getInfoFor;
                                 iface_tool portal/portal_interface;
                                 orderable_iface string:Products.CMFPlone.interfaces.OrderedContainer.IOrderedContainer;
                                 canModifyFolderContent python:checkPermission('Modify portal content', here);
                                 isOrderable python:iface_tool.objectImplements(here, orderable_iface);
                                 nosortclass python:test(isOrderable, 'nosort', '')">

          <tal:contentTypes condition="not: allowedSortedContentTypes|nothing">
            <metal:block tal:define="global allowedSortedContentTypes python:here.sortObjects(here.allowedContentTypes());" />
          </tal:contentTypes>

          <div tal:condition="standalone|nothing"
               tal:define="types contentTypes">

            <!-- Add Item pulldown -->
            <label for="select_add_item">
              <span class="hiddenLabel" i18n:translate="label_add_item">Select an item to add</span>
            </label>

            <select id="select_add_item"
                    name="type_name"
                    tabindex=""
                    tal:condition="python: num_types > 1"
                    tal:attributes="tabindex tabindex/next|nothing">

              <option value="Select" i18n:translate="label_select">Select</option>
              <metal:block tal:repeat="ctype types">
                <option value="Document"
                        tal:define="Id ctype/getId"
                        tal:attributes="value ctype/getId"
                        tal:content="ctype/Title"
                        i18n:translate="">Document</option>
              </metal:block>
            </select>

            <input type="hidden"
                   name="type_name"
                   value="Content Type Id"
                   tal:condition="python: num_types==1"
                   tal:attributes="value python:types[0].getId()" />

            <input class="standalone"
                   type="submit"
                   name="folder_factories:method"
                   value="Add New Item"
                   tabindex=""
                   i18n:attributes="value"
                   tal:condition="python: num_types"
                   tal:attributes="tabindex tabindex/next|nothing;
                                   value python:test( num_types == 1
                                   , here.translate('Add New ${type}', {'type': types[0].Title()},'Add New '+types[0].Title() )
                                   , 'Add New Item');" />
          </div>


          <table id="sortable"
                 class="listing"
                 summary="Content listing"
                 cellpadding="0" cellspacing="0">

            <thead>

              <metal:block tal:condition="batch|not:standalone|nothing">
                <tr>
                  <th class="nosort"><input class="noborder"
                                            type="checkbox"
                                            src="select_all_icon.gif"
                                            name="selectButton"
                                            title="Select all items"
                                            onClick="toggleSelect(this);"
                                            tal:attributes="src string:$portal_url/select_all_icon.gif"
                                            alt="Select all items"
                                            i18n:attributes="title alt"
                                            />
                  </th>
                  <!-- Careful with that markup, Eugene ;)
                       nbsp sucks, but blame the browsers.
                       ~limi -->
                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:title i18n:translate="listingheader_title"
                      >Title</tal:title>&nbsp;</th>
                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:size i18n:translate="listingheader_size"
                      >Size</tal:size>&nbsp;</th>
                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:modified i18n:translate="listingheader_modified"
                      >Modified</tal:modified>&nbsp;</th>

                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:state i18n:translate="listingheader_status"
                      >State</tal:state>&nbsp;</th>
                  <th class="nosort"
                      tal:condition="python:isOrderable and canModifyFolderContent"
                      >&nbsp;<tal:order i18n:translate="listingheader_order"
                      >Order</tal:order>&nbsp;</th>
                </tr>
              </metal:block>
            </thead>

            <metal:block tal:condition="batch|not:standalone|nothing">
              <tbody tal:define="getRelativeContentURL nocall:utool/getRelativeContentURL">
                <metal:block tal:repeat="item batch">
                  <tr tal:define="oddrow repeat/item/odd;
                                  item_url item/absolute_url;
                                  item_id item/getId;
                                  item_title_or_id item/title_or_id;
                                  item_typeinfo item/getTypeInfo;
                                  arrowUp portal/arrowUp.gif;
                                  arrowDown portal/arrowDown.gif;"
                      tal:attributes="class python:test(oddrow, 'even', 'odd')" >

                    <td>
                      <input type="checkbox" class="noborder" name="ids:list" id="#"
                             value="#"
                             tal:attributes="value item/getId;
                                             id python: 'cb_'+item.getId();
                                             checked request/ids_checked|nothing;
                                             tabindex tabindex/next|nothing; alt string:Select $item_title_or_id;
                                             title string:Select $item_title_or_id"/>
                      <input type="hidden" name="obj_paths:list" value="#"
                             tal:attributes="value python:getRelativeContentURL(item)" />
                    </td>

                    <td tal:define="action python:item_typeinfo.getActionById('view');
                                    url python:test(item_typeinfo.getId() in use_folder_contents,
                                    item_url+'/folder_contents',
                                    item_url+'/'+action);">

                      <a href="#" tal:attributes="href url; title item/Description;">

                        <img tal:define="icon python:item.getIcon(1); iconObject python:getattr(here,icon)"
                             tal:attributes="src string:$portal_url/$icon;
                                             alt iconObject/title_or_id;
                                             title item_typeinfo/Title"
                             />&nbsp;<span tal:replace="item/title_or_id">Title</span>
                      </a>

                      <a href="absolute_url/external_edit"
                         tal:condition="python:site_properties.ext_editor and item_typeinfo.getActionById('external_edit',None) and checkPermission('Modify portal content', item)"
                         tal:attributes="href string:$item_url/external_edit">
                        <img tal:replace="structure python:pencil_icon.tag(title='Edit with External Editor')" />
                      </a>

                      <img tal:define="lockable python:hasattr(item, 'wl_isLocked')"
                           tal:condition="python:(lockable and item.wl_isLocked()) or (lock_tool and lock_tool.isLockedOut(item))"
                           tal:replace="structure python:locked.tag(title='Locked')" />

                      <span class="state-expired"
                            tal:condition="python:isExpired(item)"
                            i18n:translate="time_expired">expired</span>
                    </td>

                    <td tal:define="folderish item/isPrincipiaFolderish|nothing">
                      <span tal:condition="folderish"> &nbsp; </span>
                      <span tal:condition="not: folderish"
                            tal:define="size python:getObjSize(item)"
                            tal:content="structure python:test(size, size, '&nbsp;')"> size </span>
                    </td>

                    <td tal:content="item/ModificationDate">
                      08/19/2001 03:01 AM
                    </td>

                    <td class="private"
                        tal:define="review_state python:getInfoFor(item, 'review_state', '')"
                        tal:content="structure python:test(review_state, review_state, '&nbsp;')"
                        tal:attributes="class python:test(review_state, 'state-'+review_state, 'state-private')"
                        i18n:translate="">&nbsp;
                    </td>
                    <td tal:condition="python:isOrderable and canModifyFolderContent">
                      <a href=""
                         title="Move item up"
                         i18n:attributes="title"
                         tal:attributes="href string:$here_url/folder_position?position=up&amp;id=$item_id"
                         ><img tal:replace="structure arrowUp" /></a>
                         &nbsp;
                         <a href=""
                            title="Move item down"
                            i18n:attributes="title"
                            tal:attributes="href string:$here_url/folder_position?position=down&amp;id=$item_id"
                            ><img tal:replace="structure arrowDown" /></a>
                    </td>
                  </tr>
                </metal:block>
              </tbody>
            </metal:block>
          </table>
        </metal:block>

        <!-- Navigation -->
        <div metal:use-macro="here/batch_macros/macros/navigation" />

        <tal:buttons tal:repeat="button actions/folder_buttons|nothing">
          <input class="context"
                 type="submit"
                 name=""
                 value=""
                 tabindex=""
                 tal:condition="python:batch or (here.cb_dataValid and button['id'] == 'paste')"
                 i18n:attributes="value"
                 tal:attributes="value button/name;
                                 name button/url;
                                 tabindex tabindex/next;
                                 class python:test((button['id'] == 'paste'), 'standalone', 'context')" />
        </tal:buttons>
      </form>

      <tal:defaultview condition="python: not 'index_html' in here.contentIds() and
                                  checkPermission('Add portal content', here) and
                                  'Document' in contentTypes and
                                  here.getTypeInfo().allowType('Document')">

        <p i18n:translate="description_no_default_folder_create_new">
          If you want to create a default page in this folder that will
          replace the ordinary item listing in a folder, click this button.
        </p>

        <form action=""
              method="post"
              tal:attributes="action string:$here_url/invokeFactory">
          <input type="hidden"
                 name="id"
                 value="index_html"/>
          <input type="hidden"
                 name="type_name"
                 value="Document"/>
          <input class="standalone"
                 type="submit"
                 value="Create default document"
                 i18n:attributes="value"
                 />
        </form>
      </tal:defaultview>


    </div>


  </body>
</html>
