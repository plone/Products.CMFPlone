<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plone"
      metal:use-macro="here/main_template/macros/master">

<body>


<div metal:fill-slot="main"
     tal:define="folderfilter python:request.get('folderfilter', '');
                 global decodedFilter python:here.decodeFolderFilter(folderfilter);
                 global filterValues decodedFilter;
                 global filter decodedFilter;
                 standalone python:1;
                 folder_contents python:here.getFolderContents(contentFilter=filter, suppressHiddenFiles=1);
                 mtool mtool|here/portal_membership;
                 myfolder python:here.absolute_url()==mtool.getHomeUrl();">
    <form name="folderContentsForm"
          method="post"
          action="folder_object"
          tal:attributes="action here/absolute_url"
          tal:define="b_start python:request.get('b_start', 0);
                      results folder_contents;
                      Batch python:modules['Products.CMFPlone'].Batch;
                      batch python:Batch(results, 100, int(b_start), orphan=0);">

            <div class="title">

                <h1 class="folderName" tal:condition="myfolder">
                <img tal:replace="structure here/folder.gif" />
                <span i18n:translate="heading_my_folder" tal:omit-tag="">My Folder</span>
                </h1>

                <h1 tal:condition="not:myfolder">
                <img tal:replace="structure here/folder.gif" />
                <span tal:content="here/title_or_id" tal:omit-tag="">Directory Id</span>
                </h1>

            </div>

            <metal:block tal:condition="not: folder_contents">
            <p i18n:translate="description_no_visible_items_press_add">
            This folder has no visible items. To add content, press the 'Add New Item' button,
            or paste content from another location.
            </p>
            </metal:block>

            <p tal:condition="myfolder"
                  i18n:translate="description_contains_items_by">
            Contains the items created and collected by <tal:block content="python:user.getUserName()" i18n:name="name">User</tal:block>
            </p>

            <p tal:content="structure here/Description"
               tal:condition="not:myfolder">
               description
            </p>

            <!-- Navigation -->
            <div metal:use-macro="here/batch_macros/macros/navigation" />
            <metal:block define-macro="folder_listing"
                         tal:define="locked portal_object/lock_icon.gif;
                                     pencil_icon portal_object/edit.gif;
                                     use_folder_contents site_properties/use_folder_contents;
                                     filterOut here/getNotAddableTypes;
                                     filterValues decodedFilter/keys | nothing;
                                     types python:here.sortObjects(here.allowedContentTypes());
                                     no_types python:len(types);
                                     filterTypes python:test( filterValues==nothing, types, here.filterTypes(filter));
                                     isExpired nocall:here/isExpired;
                                     toPortalTime nocall:here/toPortalTime;
                                     getObjSize nocall:here/getObjSize;
                                     lock_tool here/portal_lock|nothing;
				     getInfoFor python:wtool.getInfoFor;
                                     iface_tool here/portal_interface;
                                     orderable_iface string:Products.CMFPlone.interfaces.OrderedContainer.IOrderedContainer;
                                     isOrderable python:iface_tool.objectImplements(here, orderable_iface);
                                     nosortclass python:test(isOrderable, 'nosort', '')">

            <table id="sortable"
                   class="listing"
                   summary="Content listing"
                   cellpadding="0" cellspacing="0">

                <thead>
                    <tr tal:condition="standalone|nothing">
                        <td class="top" colspan="6">

                            <!-- Add Item pulldown -->
                            <label for="select_add_item"><span class="hiddenlabel" i18n:translate="label_add_item">Select an item to add</span>
			    <select id="select_add_item"
				    name="type_name"
                                    tabindex=""
                                    tal:condition="python:test(no_types > 1, 1, 0)"
                                    tal:attributes="tabindex tabindex/next|nothing"
				    alt="Add an item" >
                                <option value="Select" i18n:translate="label_select">Select</option>
                                <metal:block tal:repeat="ctype types">
                                <option value="Document"
                                        tal:condition="python: ctype.getId() not in filterOut"
                                        tal:attributes="value ctype/getId"
                                        tal:content="ctype/Title"
                                        i18n:translate="">Document</option>
                                </metal:block>
                            </select>
			    </label>

                            <input type="hidden"
                                   name="type_name"
                                   value="Content Type Id"
                                   tal:condition="python:test(no_types==1, 1, 0)"
                                   tal:attributes="value python:types[0].getId()" />

                            <input class="standalone"
                                   type="submit"
                                   name="folder_factories:method"
                                   value="Add New Item"
                                   tabindex=""
                                   style="font-size: 100%;"
                                   i18n:attributes="value"
                                   tal:condition="types"
                                   tal:attributes="tabindex tabindex/next|nothing;
                                                   value python:test( no_types == 1
                                                                    , 'Add New ' + types[0].Title()
                                                                    , 'Add New Item');" />
                        </td>
                    </tr>

                    <metal:block tal:condition="folder_contents|not:standalone|nothing">
                    <tr>
                        <th class="nosort"><input class="noborder"
                                                 type="checkbox"
                                                 src="select_all_icon.gif"
                                                 name="selectButton"
                                                 title="Select all items"
                                                 onClick="toggleSelect(this); return false;"
                                                 tal:attributes="src string:$portal_url/select_all_icon.gif"
						 alt="Select all items"
                                                 i18n:attributes="title alt"
                                                 /></th>
                        <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                        i18n:translate="listingheader_title">Title</span>&nbsp;</th>
                        <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                        i18n:translate="listingheader_type">Type</span>&nbsp;</th>
                        <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                        i18n:translate="listingheader_size">Size</span>&nbsp;</th>
                        <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                        i18n:translate="listingheader_modified">Modified</span>&nbsp;</th>
                        <th tal:attributes="class python:nosortclass">&nbsp;<span tal:omit-tag=""
                        i18n:translate="listingheader_status">State</span>&nbsp;</th>
                        <th class="nosort" tal:condition="isOrderable">&nbsp;<span tal:omit-tag=""
                        i18n:translate="listingheader_order">order</span>&nbsp;</th>
                    </tr>
                    </metal:block>
                </thead>

                <metal:block tal:condition="folder_contents|not:standalone|nothing">
                <tbody>
                <metal:block tal:repeat="item batch">
                    <tr tal:define="oddrow repeat/item/odd;
                                    item_typeinfo item/getTypeInfo"
                        tal:attributes="class python:test(oddrow, 'even', 'odd')" >

                        <td>
                            <input type="checkbox" class="noborder" name="ids:list" id="#"
                                   value="#"
                                   tal:attributes="value item/getId;
                                                   id python: 'cb_'+item.getId();
                                                   checked request/ids_checked|nothing;
                                                   tabindex tabindex/next|nothing; alt string:Select ${item/title_or_id};
                                                   title string:Select ${item/title_or_id}"/>
                            <input type="hidden" name="obj_paths:list" value="#"
                                   tal:attributes="value python:utool.getRelativeContentURL(item)" />
                        </td>

                        <td tal:define="action python:item_typeinfo.immediate_view;
                                        url python:test(item_typeinfo.getId() in use_folder_contents,
                                                        item.absolute_url()+'/folder_contents',
                                                        item.absolute_url()+'/'+action);">

                            <a href="#" tal:attributes="href url">

                                <img tal:define="icon python:item.getIcon(1); iconObject python:getattr(here,icon)"
                                     tal:attributes="src string:$portal_url/$icon; alt iconObject/title_or_id"
                                />&nbsp;<span tal:replace="item/title_or_id">Title</span>
                            </a>
                            <tal:block tal:condition="python:site_properties.ext_editor and item_typeinfo.getActionById('external_edit',None)">

                            <a href="absolute_url/external_edit"
                               tal:attributes="href string:${item/absolute_url}/external_edit">
                               <img tal:replace="structure python:pencil_icon.tag(title='Edit with External Editor')" />
                             </a>

                            </tal:block>

                            <img tal:define="lockable python:hasattr(item, 'wl_isLocked')"
                                 tal:condition="python:(lockable and item.wl_isLocked()) or (lock_tool and lock_tool.isLockedOut(item))"
                                 tal:replace="structure python:locked.tag(title='Locked')" />

                          <span class="expired"
                                tal:condition="python:isExpired(item)"
                                i18n:translate="time_expired">expired</span>
                        </td>

                        <td i18n:translate="" tal:content="python:item_typeinfo.Title()">
                        folder
                        </td>

                        <td tal:define="size python:getObjSize(item)"
                            tal:content="structure python:test(size, size, '&nbsp;')">
                        size
                        </td>

                        <td tal:content="python:toPortalTime(item.ModificationDate())">
                        08/19/2001 03:01 AM
                        </td>

                        <td class="private"
                            tal:define="review_state python:getInfoFor(item, 'review_state', '')"
                            tal:content="structure python:test(review_state, review_state, '&nbsp;')"
                            tal:attributes="class python:test(review_state, 'state-'+review_state, 'state-private')"
                            i18n:translate="">&nbsp;
                        </td>
                        <td tal:condition="isOrderable">
                            <a href=""
                               tal:attributes="href string:${here/absolute_url}/folder_position?position=up&amp;id=${item/getId}"
                            ><img tal:replace="structure here/portal_url/arrowUp.gif" /></a>
                            &nbsp;
                            <a href=""
                               tal:attributes="href string:${here/absolute_url}/folder_position?position=down&amp;id=${item/getId}"
                            ><img tal:replace="structure here/portal_url/arrowDown.gif" /></a>
                        </td>
                    </tr>
                </metal:block>
                </tbody>
                </metal:block>
            </table>
            </metal:block>

            <!-- Navigation -->
            <div metal:use-macro="here/batch_macros/macros/navigation" />

            <tal:block tal:repeat="button actions/folder_buttons|nothing">
            <input class="context"
	               type="submit"
	               name=""
                   value=""
                   tabindex=""
                   tal:condition="python:folder_contents or (here.cb_dataValid and button['id'] == 'paste')"
                   i18n:attributes="value"
                   tal:attributes="value button/name;
                                   name button/url;
                                   tabindex tabindex/next;" />
           </tal:block>


    </form>

    <div tal:condition="python:not getattr(here.aq_explicit, 'index_html', None) and
                        here.portal_membership.checkPermission('Add portal content', here) and
						here.getTypeInfo().allowType('Document')">

        <p i18n:translate="description_no_default_folder_create_new">
        This folder does not have a default page, therefore a list of items
        is shown instead.
        If you want to create a default page in this folder that will
        replace the item listing, click the button.
        </p>

        <form action=""
              method="post"
              tal:attributes="action string:${here/absolute_url}/invokeFactory">
            <input type="hidden"
                   name="id"
                   value="index_html"/>
            <input type="hidden"
                   name="type_name"
                   value="Document"/>
            <input class="standalone"
                   type="submit"
                   value="Create default document"
                   i18n:attributes="value"
                   />
        </form>
    </div>


</div>


</body>
</html>
