<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<span tal:condition="nothing"
      tal:define="has_add_priv nocall: here/add_issue">
  This span ensures that the visitor has edit privilege, by fetching - but not
  displaying - the protected collector.add_issue method.
</span>
<tal:block tal:condition="nothing">
  Template description: Form for submitting new collector issues.
</tal:block>

<body>

<div metal:fill-slot="header">

<h1 i18n:translate="heading_add_new_issue_to">
Add new issue to <tal:block content="here/title_or_id"
i18n:name="collector_title">TITLE</tal:block>
</h1>

<div id="description" i18n:translate="description_add_new_issue">
Use this form to add your issue to the Collector. Please provide as many details
as possible.
</div>

</div>

<div metal:fill-slot="main">

<div tal:define="pm python: here.portal_membership;
                 authenticated python: member.has_role('Authenticated')
                                         or member.has_role('Member')">

<form class="group"
        method="post"
        enctype="multipart/form-data"
        action=""
        tal:attributes="action string:${here/absolute_url}/collector_add_issue"
        >

    <span class="legend" i18n:translate="legend_issue_details">Issue Details</span>

    <div class="row">
        <div class="label" i18n:translate="label_title">Title</div>

        <div class="field">
            <input type="text" name="title" value="" size="40" />
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_security">Security</div>
        <div class="field">
            <input type="hidden" name="security_related:boolean" value="" />
            <input class="noborder"
                   type="checkbox"
                   name="security_related:boolean"
                   />

            <span i18n:translate="label_security_related_desc">
            Yes, this issue is security related, and
            should <strong>not</strong> be publicly visible until
            completed.
            </span>

        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_submitter">Submitter</div>

        <div class="field"
             tal:condition="authenticated"
             tal:content="python: member.getProperty('full_name',
                                                      str(member))">
        </div>

        <div class="field"
              tal:condition="not: authenticated">
            <input type="text" name="submitter_name" size="30" />
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_email">Email</div>

        <div class="field">
            <input type="text" name="submitter_email" size="30"
                   tal:attributes="value python: member.getProperty('email',
                                                                    '')" />
            <span tal:condition="python: not authenticated and
                                       here.participation != 'anyone'">
                  NOTE that anonymous-submitted issues do not allow submitter
                  to followup.
            </span>

        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_topic"> Topic </div>

        <div class="field">
            <select name="topic">
              <option value=""
                      tal:repeat="it here/topics"
                tal:attributes="value it"
                tal:content="it"></option>
            </select>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_importance">Importance</div>

        <div class="field">
         <select name="importance">
           <option value=""
                   tal:repeat="it here/importances"
                   tal:attributes="value it"
                   tal:content="it"></option>
         </select>
        </div>

    </div>

    <div class="row">
        <div class="label" i18n:translate="label_classification">Classification</div>

        <div class="field">
         <select name="classification">
           <option value=""
                   tal:repeat="it here/classifications"
                   tal:attributes="value it"
                   tal:content="it"></option>
         </select>
        </div>

    </div>

    <div class="row">
        <div class="label" i18n:translate="label_version_info">Version Info</div>
        <div class="field">
            <textarea name="version_info" rows="3" cols="35"
                      tal:content="here/version_info_spiel"></textarea>
        </div>
    </div>


    <metal:block tal:define="assigner python: pm.checkPermission(
                                              'Support collector issue', here);
                             supporters here/supporters">

    <div class="row">
         <div class="label" i18n:translate="label_description">Description</div>
         <div class="field">
           <textarea name="description:text" rows="10" cols="55" i18n:translate="help_prefix_lines_with_whitespace"></textarea>
         </div>

    </div>

    <div class="row" tal:condition="assigner">
        <div class="label" i18n:translate="label_assign_to">Assign to</div>
        <div class="field">
           <select name="assignees:list" multiple="multiple" size="5"
                   tal:attributes="size python:
                                        min(max(len(supporters), 3), 8)">
             <option tal:repeat="supporter supporters"
                      tal:content="supporter">
               SUPPORTER
             </option>
           </select>
        </div>
    </div>

    </metal:block>

    <div class="row">
        <div class="label" i18n:translate="label_attachment_optional">Attachment (optional)</div>
        <div class="field">
            <input type="file" name="file" size="20" />
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_attachment_type_optional"> Attachment type (optional)</div>
        <div class="field">
            <input class="noborder" type="radio" name="filetype" id="radio_file" value="File" checked="checked" />
	    <label for="radio_file" i18n:translate="">File</label>
            <input class="noborder" type="radio" name="filetype" id="radio_image" value="Image" />
	    <label for="radio_image" i18n:translate="">Image</label>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_name_of_upload_optional">Name of upload (optional)</div>
        <div class="field">
            <input type="text" name="fileid" size="12" />
        </div>
    </div>

    <div class="row">
        <div class="label">&nbsp;</div>
        <div class="field">
         <input class="context" type="submit" value="Submit" i18n:attributes="value" />
        </div>
    </div>

</form>

</div>

</div>

</body>

</html>
