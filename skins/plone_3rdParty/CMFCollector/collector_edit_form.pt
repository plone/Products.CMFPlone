<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<span tal:condition="nothing"
      tal:define="has_edit_priv nocall: here/edit">
  This span ensures that the visitor has edit privilege, by fetching - but not
  displaying - the protected collector.edit method.
</span>
<div metal:fill-slot="header">

<h1 i18n:translate="heading_collector_configuration">Collector Configuration</h1>

</div>

<div metal:fill-slot="main">

<form class="group"
      action=""
      method="post"
      tal:attributes="action string:${here/absolute_url}/collector_edit"
      >

    <span class="legend" i18n:translate="legend_collector_details">Collector Details</span>

    <div class="row"
         tal:condition="python: member.getProperty('visible_ids', None)"
         tal:define="error_id errors/id | nothing;
                     id python:request.get('id', here.getId());">
        <div class="label required">

            <span i18n:translate="label_name">Name</span>

            <div id="id_help"
                 i18n:translate="help_name"
                 class="help"
                 style="visibility:hidden">
            Enter the ID of the document. This is the part that will show up as part
            of the web address. This should be short, descriptive
            and preferrably not contain spaces, underscores or mixed case. Example:
            "expense-report-2002"
            </div>
        </div>

        <div class="field"
              tal:attributes="class python:test(error_id, 'field error', 'field')" >

            <div tal:replace="error_id" />

            <input type="text"
                   name="id"
                   value="#"
                   size="30"
                   tabindex="1"
                   onfocus="formtooltip('id_help',1)"
                   onblur="formtooltip('id_help',0)"
                   tal:attributes="value id;"
                   />
        </div>

    </div>
    <input type="hidden"
           name="id"
           tal:condition="python: not member.getProperty('visible_ids', None)"
           tal:attributes="value python:request.get('id', here.getId())"
           />

    <div class="row">
        <div class="label" i18n:translate="label_title">Title</div>
        <div class="field">
            <input type="text"
                   name="title"
                   value=""
                   tal:attributes="value here/title"
                   size="45" />
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_abbreviation">
        Abbreviation

        </div>
        <div class="field">
            <input type="text"
                   name="abbrev"
                   value=""
                   onfocus="formtooltip('abbrev_help',1)"
                   onblur="formtooltip('abbrev_help',0)"
                   tal:attributes="value here/abbrev|nothing"
                   size="5" />
            <div id="abbrev_help"
                 i18n:translate="help_abbreviation"
                 class="help"
                 style="visibility:hidden">
            Abbreviation for the collector, used as the prefix of
            the subject line in mail from the collector.
            </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_description">Description</div>
        <div class="field">
            <textarea name="description:text" rows="3"
                      cols="50"
                      tal:content="here/description">
            </textarea>
        </div>
    </div>

    <div class="row">
        <div class="label required" i18n:translate="label_collector_email">Collector email</div>
        <div class="field"
             tal:define="getpropemail python: hasattr(member, 'getProperty')
                                              and member.getProperty('email', '');
                         attremail python: getattr(member, 'email', '');
                         email python: getattr(here, 'email',
                                                getpropemail or attremail)">

            <input type="text"
                   name="email"
                   size="25"
                   value="EMAIL"
                   onfocus="formtooltip('email_help',1)"
                   onblur="formtooltip('email_help',0)"
                   tal:attributes="value email" />
        <div id="email_help"
                 i18n:translate="help_email"
                 class="help"
                 style="visibility:hidden">
        This is the collector's email 'From' address.
        </div>

        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_collector_managers">Managers</div>
        <div class="field">
            <textarea name="managers:lines" rows="5" cols="15"
                      tal:define="mgrs python:'\n'.join([m for m in here.managers])"
		      onfocus="formtooltip('managers_help',1)"
		      onblur="formtooltip('managers_help',0)"
                      tal:content="mgrs"></textarea>
            <div id="managers_help"
                 i18n:translate="help_collector_managers"
                 class="help"
                 style="visibility:hidden">
            Managers configure the collector, and receive request notices.
            Managers can accept issues, but must be on Supporters roster to be
            assigned.  (Managers cannot remove <em>themselves</em> from the
            management roster.)
            </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_collector_supporters">Supporters</div>
        <div class="field">
            <textarea name="supporters:lines" rows="5" cols="15"
		      onfocus="formtooltip('supporters_help',1)"
		      onblur="formtooltip('supporters_help',0)"
                      tal:define="supporters python:'\n'.join([s for s in here.supporters])"
		      tal:content="supporters"></textarea>
            <div id="supporters_help"
                 i18n:translate="help_collector_supporters"
                 class="help"
                 style="visibility:hidden">
            Supporters can be assigned to requests.  They may or may not
            receive initial request notifications, depending on the
            'dispatching' setting below.
            </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_collector_dispatcher_mode">Dispatcher Mode</div>
        <div class="field">
            <div style="float:left">
            <input class="noborder"
                   type="radio"
                   name="dispatching:int"
                   value="0"
                   tal:attributes="checked not: here/dispatching|nothing" />
            <span i18n:translate="label_collector_dispatcher_off">
        Off (Managers and supporters receive pending-issue notices)
        </span>


            <br />

            <input class="noborder"
                   type="radio"
                   name="dispatching:int"
                   value="1"
                   tal:attributes="checked here/dispatching|nothing" />
        <span i18n:translate="label_collector_dispatcher_on">
            On (Only managers receive pending-issue notices)
        </span>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_collector_participation_mode">Participation Mode</div>
        <div class="field">
            <div style="float: left">
                <input class="noborder"
                       type="radio"
                       name="participation:string"
                       value="staff"
                       tal:attributes="checked python: here.participation
                                                       == 'staff'" />
                  <span i18n:translate="label_collector_staff">
          Staff

                  (Only collector staff and issue requester participate in an
                  issue)
          </span>

                <br />

                <input class="noborder"
                       type="radio"
                       name="participation:string"
                       value="authenticated"
                       tal:attributes="checked python: here.participation
                                                       == 'authenticated'" />
                  <span i18n:translate="label_collector_authenticated">
          Authenticated

                  (Any non-anonymous visitors can participate)
          </span>

                <br />

                <input class="noborder"
                       type="radio"
                       name="participation:string"
                       value="anyone"
                       tal:attributes="checked python: here.participation
                                                       == 'anyone'" />
                  <span i18n:translate="label_collector_anyone">
          Anyone

                  (Anyone, including anonymous visitors, can chime in)
          </span>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_notifications">Notifications</div>
        <div class="field">
            <div style="float:left">
            <metal:block tal:define="states here/issue_states;"
                         tal:repeat="state states">

                <span tal:omit-tag="" i18n:translate=""><span tal:replace="state">State:</span></span>

                <br />

                <input type="text"
                       size="30"
                       name="stateemail"
                       value=""
		       onfocus="formtooltip('notification_help',1)"
		       onblur="formtooltip('notification_help',0)"
                       tal:attributes="name python: 'state_email.' + state
                                                    + ':record';
                                       value python: here.state_email.get(state, '')" />
                <br />

            </metal:block>
            </div>
            <div id="notification_help"
                 i18n:translate="help_collector_notifications"
                 class="help"
                 style="visibility:hidden">
            Fill in addresses next to the state names to have notifications for
            issues in that state sent to those addresses (this is in addition to
            normal issue-participant notifications)
            </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_selections">Selections</div>
        <div class="field">
            <div style="float: left">

            <span i18n:translate="label_collector_topics">Topics</span>
            <textarea name="topics:lines" rows="5" cols="15"
                      onfocus="formtooltip('selections_help',1)"
                      onblur="formtooltip('selections_help',0)"
                      tal:define="topics python:'\n'.join([t for t in here.topics])"
                      tal:content="topics"></textarea>

            <span i18n:translate="label_collector_classifications">Classifications</span>
            <textarea name="classifications:lines" rows="5" cols="15"
                      onfocus="formtooltip('selections_help',1)"
                      onblur="formtooltip('selections_help',0)"
                      tal:define="classi python:'\n'.join([c for c in here.classifications])"
                      tal:content="classi"></textarea>

            <span i18n:translate="label_collector_importance">Importance</span>
            <textarea name="importances:lines" rows="5" cols="15"
                      onfocus="formtooltip('selections_help',1)"
                      onblur="formtooltip('selections_help',0)"
                      tal:define="imp python:'\n'.join([i for i in here.importances])"
                      tal:content="imp"></textarea>
            </div>
            <div id="selections_help"
                 i18n:translate="help_collector_selections"
                 class="help"
                 style="visibility:hidden">
            Fill in the alternatives for issue categorization.
	    </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_version_boilerplate">Version boilerplate</div>
        <div class="field">
   <textarea name="version_info_spiel:text" rows="3" cols="50"
             onfocus="formtooltip('version_bp_help',1)"
	     onblur="formtooltip('version_bp_help',0)"
             tal:content="here/version_info_spiel|nothing"></textarea>

            <div id="version_bp_help"
                 i18n:translate="help_collector_version_boilerplate"
                 class="help"
                 style="visibility:hidden">
            The text shown to users about what kind of version information they should include.
	    </div>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_reinstate_catalog">Reinstate catalog</div>
        <div class="field">
            <div style="float: left">
                <input class="noborder"
		       id="reinstate_no"
                       type="radio"
                       name="recatalog:int"
                       value="0"
                       checked="checked"
		       onfocus="formtooltip('reinstate_help',1)"
		       onblur="formtooltip('reinstate_help',0)"
                       />

                <label for="reinstate_no" i18n:translate="label_collector_reinstate_no">No</label><br />

                <input class="noborder"
		       id="reinstate_internal"
                       type="radio"
                       name="recatalog:int"
                       value="1"
		       onfocus="formtooltip('reinstate_help',1)"
		       onblur="formtooltip('reinstate_help',0)"
                       />

                <label for="reinstate_internal" i18n:translate="label_collector_reinstate_internal_only">Internal only</label><br />

                <input class="noborder"
		       id="reinstate_sitewide"
                       type="radio"
                       name="recatalog:int"
                       value="2"
		       onfocus="formtooltip('reinstate_help',1)"
		       onblur="formtooltip('reinstate_help',0)"
                       />

               <label for="reinstate_sitewide" i18n:translate="label_collector_reinstate_sitewide">Internal &amp; Site-wide (slow)</label><br />

            </div>
            <div id="reinstate_help"
                 i18n:translate="help_collector_reinstate"
                 class="help"
                 style="visibility:hidden">
                Occasionally, product updates require internal catalog reinit and
                reindex and other existing-issue adjustment.  Collector product
                RELEASE_NOTES.txt will indicate when necessary.
	    </div>
        </div>
    </div>

    <div class="row">
        <div class="label"> &nbsp; </div>
        <div class="field">
            <input class="context" type="submit" value="Submit" i18n:attributes="value" />
            <input class="standalone" type="reset" value="Reset" i18n:attributes="value" />
        </div>
    </div>

</form>

</div>

</html>
