<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/prefs_main_template/macros/master"
      i18n:domain="plone">

<body>


<metal:main metal:fill-slot="prefs_configlet_main" i18n:domain="plone">
  <header>

    <h1 class="documentFirstHeading"
        i18n:translate="">Resource Registry</h1>

    <div class="text-muted"
       i18n:translate="">
      Configure Plone JavaScript/CSS resource bundles.
    </div>
  </header>

   <div id="content-core">
    <div class="accordion" id="accordionRR" tal:define="dummy python:view.process_form()">
      <div class="accordion-item "
           tal:repeat="bundle python:view.bundles_data">
           <h2 class="accordion-header" id="heading-${python:bundle['name']}">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${python:bundle['name']}" aria-expanded="false" aria-controls="collapse-${python:bundle['name']}">
              <span tal:condition="python:bundle['name'] and bundle['enabled']" i18n:translate="" class="me-2"><tal:icon tal:replace="structure python:icons.tag('file-check', tag_alt='Enabled bundle')" /></span>
              <span tal:condition="python:bundle['name'] and not bundle['enabled']" i18n:translate="" class="me-2"><tal:icon tal:replace="structure python:icons.tag('file-x', tag_alt='Disabled bundle')" /></span>
              <span tal:condition="python:not bundle['name']" i18n:translate="" class="me-2"><tal:icon tal:replace="structure python:icons.tag('file-plus', tag_alt='Add a bundle')" /></span>
              <strong tal:condition="python:bundle['name']">${python:bundle["name"]}</strong>
              <strong tal:condition="python:not bundle['name']">Add new bundle</strong>
            </button>
          </h2>
          <div id="collapse-${python:bundle['name']}" class="accordion-collapse ${python:'' if bundle['name'] == request.form.get('name', None) else 'collapse'}" aria-labelledby="heading${python:bundle['name']}" data-bs-parent="#accordionRR">
            <div class="accordion-body">
              <form method="post" action="${python:context.absolute_url()}/@@resourceregistry-controlpanel">
                <input type="hidden" name="original_name" value="${python:bundle['name']}" />
                <div class="mb-3">
                  <label for="name" class="form-label">Name</label>
                  <input type="text" class="form-control" name="name" value="${python:bundle['name']}"/>
                </div>
                <div class="mb-3">
                  <label for="jscompilation" class="form-label">Javascript</label>
                  <input type="text" class="form-control" name="jscompilation" value="${python:bundle['jscompilation']}"/>
                </div>
                <div class="mb-3">
                  <label for="csscompilation" class="form-label">CSS</label>
                  <input type="text" class="form-control" name="csscompilation" value="${python:bundle['csscompilation']}"/>
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" value="" name="enabled" ${python:"checked" if bundle["enabled"] else ''} />
                  <label class="form-check-label" for="enabled">
                    enabled
                  </label>
                </div>
                <div class="mb-3">
                  <label for="expression" class="form-label">Condition</label>
                  <input type="text" class="form-control" name="expression" value="${python:bundle['expression']}" placeholder="expression"/>
                </div>
                <div class="mb-3">
                  <label for="depends" class="form-label">Depends on</label>
                  <input type="text" class="form-control" name="depends" value="${python:bundle['depends']}" />
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" value="1" name="load_async" ${python:"checked" if bundle["load_async"] else ''} />
                  <label class="form-check-label" for="load_async">
                    Async
                  </label>
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" value="1" name="load_defer" ${python:"checked" if bundle["load_defer"] else ''} />
                  <label class="form-check-label" for="load_defer">
                    Defer
                  </label>
                </div>
                <div class="mb-3">
                  <button tal:condition="python:bundle['name']" name="action" value="update" type="submit" class="btn btn-primary me-1">Save</button>
                  <button tal:condition="python:not bundle['name']" name="action" value="add" type="submit" class="btn btn-success me-1">Add</button>
                  <button tal:condition="python:bundle['name']" name="action" value="delete" type="submit" class="btn btn-danger">Delete</button>
                </div>
              </form>
          </div>
        </div>
      </div>
    </div>
   </div>
</metal:main>

</body>
</html>

